FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# Copy project files
COPY *.csproj ./
RUN dotnet restore

# Copy source code
COPY . ./

# Publish the application
RUN dotnet publish *.csproj \
    --configuration Release \
    --output /home/site/wwwroot \
    --runtime linux-x64 \
    --self-contained true \
    /p:PublishTrimmed=false

# Runtime stage
FROM mcr.microsoft.com/azure-functions/base:4

ENV AzureWebJobsScriptRoot=/home/site/wwwroot \
    AzureFunctionsJobHost__Logging__Console__IsEnabled=true

COPY --from=build /home/site/wwwroot /home/site/wwwroot